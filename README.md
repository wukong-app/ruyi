# å¦‚æ„ (Ruyi)

> å¦‚æ„é‡‘ç®æ£’ï¼Œéšå¿ƒæ‰€æ¬²ã€‚Ruyi èƒ½å°†ä¸‡ç‰©è½¬åŒ–ä¸ºä½ æ‰€éœ€çš„å½¢æ€ã€‚

Ruyi æ˜¯ä¸€ä¸ªåŸºäº Go è¯­è¨€å¼€å‘çš„é€šç”¨æ ¼å¼è½¬æ¢å·¥å…·åº“ã€‚å®ƒé‡‡ç”¨æ’ä»¶åŒ–æ¶æ„ï¼Œæ—¨åœ¨ä¸º `wukong` é¡¹ç›®æä¾›å¼ºå¤§ã€çµæ´»ä¸”å¯æ‰©å±•çš„æ•°æ®è½¬æ¢æ ¸å¿ƒã€‚

## ğŸŒŸ æ ¸å¿ƒç‰¹æ€§

- **æ’ä»¶åŒ–æ¶æ„**: è½¬æ¢é€»è¾‘å°è£…ä¸ºç‹¬ç«‹çš„ Converterï¼Œæ˜“äºæ‰©å±•å’Œç»´æŠ¤ã€‚
- **ç±»å‹å®‰å…¨**: åŸºäº Conceptï¼ˆæ¦‚å¿µï¼‰å’Œ Kindï¼ˆç±»å‹ï¼‰çš„å¼ºç±»å‹è®¾è®¡ã€‚
- **å‚æ•°åŒ–æ§åˆ¶**: æ”¯æŒåœ¨è½¬æ¢è¿‡ç¨‹ä¸­ä¼ é€’å‚æ•°ï¼ˆå¦‚å›¾ç‰‡ç¼©æ”¾ã€è´¨é‡æ§åˆ¶ï¼‰ã€‚
- **ç»Ÿä¸€æ¥å£**: é€šè¿‡ç»Ÿä¸€çš„ Registry å’Œ Engine è¿›è¡Œç®¡ç†ï¼Œå±è”½åº•å±‚å·®å¼‚ã€‚

## ğŸ“¦ å®‰è£…

```bash
go get github.com/wukong-app/ruyi
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åˆå§‹åŒ–å¼•æ“

```go
package main

import (
	"context"
	"fmt"
	"log"

	"github.com/wukong-app/ruyi"
	"github.com/wukong-app/ruyi/pkg/contract"
)

func main() {
	// åˆå§‹åŒ– Ruyi å¼•æ“
	ry, err := ruyi.New()
	if err != nil {
		log.Fatalf("failed to create ruyi: %v", err)
	}

	// ç¤ºä¾‹æ•°æ®ï¼ˆå®é™…ä½¿ç”¨æ—¶åº”ä¸ºçœŸå®æ–‡ä»¶å­—èŠ‚ï¼‰
	inputBytes := []byte("fake-jpeg-data") 
	ctx := context.Background()

	// ... æ¥ä¸‹æ–‡
}
```

### 2. æ‰§è¡Œè½¬æ¢

```go
	// è·å– JPEG åˆ° PNG çš„è½¬æ¢å™¨
	// contract.File è¡¨ç¤ºè½¬æ¢ç±»å‹ä¸ºæ–‡ä»¶
	// contract.JPEG å’Œ contract.PNG åˆ†åˆ«è¡¨ç¤ºæºå’Œç›®æ ‡æ ¼å¼
	converter, err := ry.GetConverter(ctx, contract.File, contract.JPEG, contract.PNG)
	if err != nil {
		log.Fatalf("converter not found: %v", err)
	}

	// å‡†å¤‡å‚æ•°ï¼ˆå¯é€‰ï¼‰
	params := map[string]string{
		"width":  "200", // ç›®æ ‡å®½åº¦
		"height": "200", // ç›®æ ‡é«˜åº¦
	}

	// æ‰§è¡Œè½¬æ¢
	outputBytes, err := converter.Convert(ctx, inputBytes, params)
	if err != nil {
		// æ³¨æ„ï¼šè¿™é‡Œçš„ inputBytes æ˜¯ä¼ªé€ çš„ï¼Œå®é™…è¿è¡Œä¼šæŠ¥é”™ï¼Œéœ€ä½¿ç”¨çœŸå®å›¾ç‰‡æ•°æ®
		log.Printf("conversion failed (expected for fake data): %v", err)
	} else {
		fmt.Printf("Successfully converted %d bytes to %d bytes\n", len(inputBytes), len(outputBytes))
	}
```

## ğŸ”Œ æ”¯æŒçš„è½¬æ¢

ç›®å‰ Ruyi ä¸»è¦æ”¯æŒä»¥ä¸‹å›¾ç‰‡æ ¼å¼çš„è½¬æ¢ï¼š

| æºæ ¼å¼  | ç›®æ ‡æ ¼å¼ | æ”¯æŒå‚æ•°è¯´æ˜                                                                               |
| :----- | :------ |:-------------------------------------------------------------------------------------|
| **JPEG** | **PNG**  | - `width`, `height`ï¼šæ”¯æŒè°ƒæ•´è¾“å‡ºå›¾ç‰‡å°ºå¯¸ï¼ˆåƒç´ ï¼‰ï¼Œ0 è¡¨ç¤ºä¸ç¼©æ”¾ã€‚                                          |
| **PNG**  | **JPEG** | - `width`, `height`ï¼šæ”¯æŒè°ƒæ•´è¾“å‡ºå›¾ç‰‡å°ºå¯¸ï¼ˆåƒç´ ï¼‰ï¼Œ0 è¡¨ç¤ºä¸ç¼©æ”¾ã€‚<br>- `quality`ï¼šJPEG å‹ç¼©è´¨é‡ (1-100)ï¼Œé»˜è®¤ 100ã€‚ |

## ğŸ— æ¶æ„æ¦‚è§ˆ

Ruyi çš„æ ¸å¿ƒç”±ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ç»„æˆï¼š

- **Ruyi (Engine)**: å¯¹å¤–æš´éœ²çš„ç»Ÿä¸€å…¥å£ï¼Œè´Ÿè´£åè°ƒç»„ä»¶å·¥ä½œã€‚
- **Registry**: æ³¨å†Œä¸­å¿ƒï¼Œç»´æŠ¤æ‰€æœ‰å·²æ³¨å†Œçš„è½¬æ¢å™¨ï¼Œæ”¯æŒ O(1) å¤æ‚åº¦æŸ¥æ‰¾ã€‚
- **Converter**: å…·ä½“çš„è½¬æ¢é€»è¾‘å®ç°è€…ï¼Œæ¯ä¸ªè½¬æ¢å™¨è´Ÿè´£ä¸€å¯¹ç‰¹å®šæ ¼å¼çš„è½¬æ¢ï¼ˆå•ä¾‹ã€æ— çŠ¶æ€ï¼‰ã€‚
- **Concept**: å®šä¹‰æ•°æ®çš„è¯­ä¹‰ï¼ˆå¦‚ `JPEG`, `PNG`ï¼‰ï¼Œç»“åˆ `Kind`ï¼ˆå¦‚ `File`ï¼‰ç¡®ä¿è½¬æ¢çš„è¯­ä¹‰æ­£ç¡®æ€§ã€‚

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue æˆ– Pull Request æ¥ä¸°å¯Œ Ruyi çš„è½¬æ¢èƒ½åŠ›ï¼è¯·ç¡®ä¿æ–°å¢çš„ Converter éµå¾ª `pkg/contract` ä¸­çš„æ¥å£å®šä¹‰ï¼Œå¹¶é™„å¸¦ç›¸åº”çš„æµ‹è¯•ç”¨ä¾‹ã€‚

## ğŸ“„ è®¸å¯è¯

MIT License
